[TOC]



# 窗口管理器术语

emWin中的一个窗口具有以下特性：

**•是矩形的；•有一个Z位置；**

**•可能隐藏或显示；**

**•可能包含有效和/或无效区域；**

**•可能有也可能没有透明度；**

**•可能有也可能没有回调函数。**

**•活动窗口**

​	当前用于绘图操作的窗口称为活动窗口。它不一定就是最上层的窗口。

**•回调函数**

​	回调函数由用户程序定义，指示图形系统在发生特定事件时调用特定函数。通常，当窗口的内容发生更改时，它们用于自动重绘窗口。**•子窗口/父窗口，同属窗口**

​	子窗口是相对于其他窗口（称为父窗口）定义的。只要父窗口移动，其子窗口就会相应移动。子窗口始终完全包含在其父窗口中，并在必要时会被裁剪。具有相同父窗口的多个子窗口被视为同属窗口。

**•客户区**

​	客户区就是窗口的的可用区域。如果一个窗口包含一个框架或标题栏，那么客户端区域就是矩形的内部区域。如果没有这样的框架，则客户端区域的坐标与窗口本身的坐标相同。

**•裁剪，裁剪区域**

​	裁剪是将输出限制为窗口或窗口的一部分的过程。窗口的剪辑区域是其可见区域，是窗口区域减去被更高Z轴阶层的同属窗口遮挡的区域，然后减去没有放入父窗口可见区域的任何部分。

**坐标**

​	坐标通常是二维坐标，以像素为单位表示。一个坐标由两个值组成。第一个值指定水平分量(也称为x坐标)，第二个值指定垂直分量(也称为y坐标)。

**•桌面坐标**

​	桌面坐标是桌面窗口的坐标。屏幕的左上角位置(原点)是(0,0)。

**•桌面窗口**

​	也叫背景窗口，是由窗口管理器自动创建的，并且总是覆盖整个显示区域。在多图层情况下，每一个图层都有自己的桌面窗口。桌面始终是最底层的窗口，当没有定义其他窗口时，它是默认的(活动的)窗口。所有窗口都是当前选定层的桌面窗口的后代(子窗口、孙窗口等)。桌面窗口在emWin初始化完成后就创建好了，之后所有的操作都在桌面窗口基础上进行。

**•前期裁剪/后期裁剪**

​	前期裁剪是默认的裁剪模式。在此模式下，裁剪动作在窗口接收绘制事件之前执行。如果需要裁剪当前窗口，它将在单个绘图过程中接收多个WM_PAINT消息。在后期裁剪模式下，窗口始终只接收一条WM_PAINT消息，此时裁剪动作在绘图操作中执行。

**•句柄**

​	创建新窗口时，窗口管理器会为其分配一个名为句柄的唯一标识符。句柄用于在该特定窗口上执行的任何进一步操作。

**•隐藏/显示窗口**

​	一个隐藏的窗口是不可见的，尽管它仍然存在(有一个句柄)。创建窗口时，如果没有指定创建标志，则默认情况下它是隐藏的。显示窗口使其可见，隐藏窗口则使其不可见。

**•父坐标**

​	父坐标是相对于父窗口的窗口坐标。窗口的左上角位置（原点）是（0,0）。

**•窗口坐标**

​	窗口坐标是窗口的坐标。窗口的左上位置（原点）是（0,0）。

**•透明度**

​	具有透明度的窗口包含不随窗口其余部分重新绘制的区域。这些区域的运作方式就像“透过”它们背后的窗口一样。在这种情况下，重要的是要在窗口之前以透明的方式重新绘制后面的窗口。窗口管理器自动按照正确的顺序处理重绘。

**•有效化/无效化**

​	一个有效的窗口是一个完全更新的窗口，它不需要重新绘制。无效窗口尚未反映所有更新，因此需要全部或部分重新绘制。当发生影响特定窗口的更改时，窗口管理器将该窗口标记为无效。下一次重新绘制窗口(手动或通过回调例程)时，将验证它。

**•Z轴位置，底部/顶部**

​	虽然窗口以X和Y的形式显示在二维屏幕上，但窗口管理器还可管理Z-位置(深度坐标)即虚拟三维中的一个位置，它决定了窗口从背景到前景的位置。因此，窗口可以出现在彼此的底部或顶部。将一个窗口设置为底部将把它“放在”它所有的同属窗口(如果有的话)下面；将它设置为顶部将会将它“置于”它的同属窗口之上。创建窗口时，如果没有指定创建标志，则默认将其设置为顶部。

# 窗口管理器的回调机制、无效化和渲染

## 使用回调函数渲染窗口

想要创建具有回调的窗口，必须定义一个回调函数。当使用WM_CreateWindow()函数创建窗口时，这个回调函数将作为参数。所有回调函数都必须的原型：

```c
void Callback(WM_MESSAGE *pMsg);
```

1)pMsg：指向**WM_MESSAGE**类型结构体的指针。回调函数中执行的具体操作取决于它接收的消息类型。窗口回调函数中需要构建一个switch语句，它使用一个或多个case语句为不同的消息定义不同的行为。通常至少需要存在一个**WM_PAINT**消息。

注意，在WM_PAINT消息中，除了重绘窗口内容外不得执行其他操作。不得在WM_PAINT消息中调用以下函数：WM_SelectWindow()、WM_PAINT()、WM_DeleteWindow()和WM_CreateWindow()。此外，类似WM_Move()和WM_Resize()这类改变窗口属性的函数也都不得在WM_PAINT消息中调用。

## 桌面窗口重绘和回调

在窗口管理器初始化期间，会创建一个包含整个LCD区域的窗口作为桌面窗口。这个窗口的句柄是WM_HBKWIN。由于没有默认的背景颜色，窗口管理器并不会自动重绘桌面窗口区域。这就意味着如果你创建了一个新的窗口然后删除它，这个窗口仍然可见不会消失。解决办法是通过WM_SetDesktopColor()函数设置用于重绘桌面窗口的颜色。或者可以设置一个回调函数来处理这个问题。如果像上面一样创建并删除一个窗口，回调函数将触发窗口管理器确认桌面窗口不再有效并自动重绘。

## 窗口无效化

